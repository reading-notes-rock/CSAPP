# 正文

## 6.1 存储技术

### 6.1.1 随机访问存储器(RAM，Random-Access Memory)

- 分类：动态(DRAM)和静态(SRAM)
  SRAM 比 DRAM 更快，也更贵
  SRAM 用做高速缓存存储器
  DRAM 用做主存以及图形系统的帧缓冲区

  #### 1.静态 RAM

  - SRAM 将每个位存储在一个双稳态的存储器单元里。每个单元是用一个六晶体管电路实现的。
  - 由于双稳态特性，只要有点，就会永远保持它的值。

  #### 2.动态 RAM

  - 对每个位存储为对一个电容的充电。
  - 对干扰非常敏感，当电容的电压被扰乱之后，它就永远不会恢复了。
  - 二者区别

    |      | 每位晶体管数 | 相对访问时间 | 持续的？ | 敏感的？ | 相对花费 |      应用      |
    | :--: | :----------: | :----------: | :------: | :------: | :------: | :------------: |
    | SRAM |      6       |      1x      |    是    |    否    |  1000x   | 高速缓存存储器 |
    | DRAM |      1       |     10x      |    否    |    是    |    1x    | 主存，帧缓冲区 |

  #### 3.传统的 DRAM

  - DRAM 芯片中的位被分成 d 个超单元，每个超单元都由 w 个 DRAM 单元组成。一个 d\*w 的 DRAM 总共存储了 dw 位的信息。

  - 超单元被组织成一个 r 行 c 列的长方形阵列，rc=d
  - 每个 DRAM 芯片被链接到某个称为内存控制器的电路

  #### 4.内存模块

  - DRAM 芯片封装在内存模块中，查到主板的扩展槽上。

  #### 5.增强的 DRAM

  - 快页模式 DRAM(Fast Page Mode DRAM,FPM DRAM)：传统的 DRAM 将超单元的一整行复制到它的内部行缓冲区中，使用一个，然后丢弃剩余的。FPM DRAM 允许对同一行连续的访问块也直接从行缓冲区得到服务。
  - 扩展数据输出 DRAM(Extended Data Out DRAM,EDO DRAM)：FPM DRAM 的一个增强的形式
  - 同步 DRAM(Synchronous DRAM,SDRAM)：常规的、FPM、EDO DRAM 都是异步的。SDRAM 比异步的存储器更快地输出它的超单元内容。
  - 双倍数据速率同步 DRAM(Double Data Rate Synchronous DRAM,DDR SDRAM)：对 SDRAM 的一种增强，通过两个时钟沿作为控制信号，从而使 DRAM 速度翻倍。
  - 视频 RAM(Video RAM, VRAM)：用在图形系统的帧缓冲区中。

  #### 6.非易失性存储器

  - 断电之后，DRAM 和 SRAM 会丢失信息，属于 易失的。观点之后仍然保存信息的，属于非易失性存储器。
  - ROM-Read-Only Memory，一般都是只读存储器
  - PROM(Programmable ROM，可编程 ROM)只能被编程一次。
  - 可擦可写编程 ROM(Erasable Programmable ROM, EPROM)
  - 电子可擦除 PROM(Electrically Erasable PROM, EEPROM)：类似于 EPROM
  - 闪存(flash memory)是一类非易失性存储器，基于 EEPROM

  #### 7.访问主存

  - 数据流通过称为总线(bus)的共享电子电路在处理器和 DRAM 主存之间来来回回。
  - 总线事务(bus transaction)：每次 CPU 和主存之间的数据传送都是通过一系列步骤来完成的，这些步骤就是 总线事务。
  - 读事务：从主存 --> CPU，写事务：从 CPU --> 主存
  - 总线是一组并行的导线，系统总线和内存总线，能携带地址、数据和控制信号
  - movq A, %rax 地址 A 的内容被加载到寄存器 %rax 中。发起读事务。
    - CPU 将地址 A 放到系统总线上。I/O 桥将信号传递到内存总线。
    - 主存感觉到内存总线上的地址信号，从内存总线读地址，从 DRAM 中取出数据字，并将数据写到内存总线。I/O 桥将内存总线信号翻译成系统总线信号，然后沿着系统总线传递。
    - CPU 感觉到系统总线上的数据，从总线上读数据，并将数据复制到寄存器%rax。
  - movq %rax, A 寄存器%rax 的内容被写到地址 A，CPU 发起写事务
    - CPU 将地址放到系统总线上。内存从内存总线读出地址，并等待数据到达。
    - CPU 将%rax 中的数据字复制到系统总线。
    - 主存从内存总线读出数据字，并且将这些位存储到 DRAM 中

### 6.1.2 磁盘存储

- 从磁盘读信息的时间为毫秒级，比 DRAM 读慢了 10 万倍，比 SRAM 读慢了 100 万倍。

  - 1. 磁盘构造
       盘片、表面、主轴、磁道、扇区、间隙
  - 2. 磁盘容量
       最大容量：一个磁盘上可以记录的最大位数，由以下技术因素决定：
       - 记录密度(位/英寸)：磁道一英寸的段中可以放入的位数
       - 磁道密度(道/英寸)：从盘片中心出发，半径上一英寸的段内可以有的磁道数
       - 面密度(位/平方英寸)：记录密度与磁道密度的乘积
       - 公式：磁盘容量 = 字节数(/扇区) \* 平均扇区数(/磁道) \* 磁道数(/表面) \* 表面数(/盘片) \* 盘片数(/磁盘)
  - 3. 磁盘操作
       - 磁盘用读/写头来读写存储在磁性表面的位
       - 寻道：通过沿着半径轴前后移动传动臂，驱动器可以将读/写头定位在盘面上的任何磁道上
       - 磁盘以扇区大小的块来读写数据。对扇区的访问时间有三个主要的部分：寻道时间、旋转时间、传送时间
       - 寻道时间：为了读取某个目标扇区的内容，传动臂首先将读写头定位到包含目标扇区的磁道上。这个所需的时间称为寻道时间。
       - 旋转时间：读写头定位到期望的磁道，驱动器等待目标扇区的第一个位旋转到读写头下，这个时间为旋转时间。
       - 传送时间：
  - 4. 逻辑磁盘块
  - 5. 链接 I/O 设备
  - 6. 访问磁盘

### 6.1.3 固态硬盘

### 6.1.4 存储技术趋势

## 6.2 局部性

## 6.3 存储器层次结构

## 6.4 高速缓存存储器

## 6.5 编写高速缓存友好的代码

## 6.6 综合：高速缓存对程序性能的影响

## 6.7 小结
